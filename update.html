<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="version" content="v1.0">
  <title>Html OS</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%; overflow: hidden;
      font-family: sans-serif;
      background: url('https://uploads.onecompiler.io/43vt3gzsr/43vt9fzgb/img1.jpg') no-repeat center center fixed;
      background-size: cover;
    }
    #boot-screen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: black; display: flex; flex-direction: column;
      justify-content: center; align-items: center; z-index: 2000;
    }
    .spinner {
      width: 50px; height: 50px; border: 5px solid #fff;
      border-top: 5px solid #0078d7; border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #boot-screen p {
      color: white; font-size: 24px; margin-top: 20px;
    }
    #taskbar {
      position: fixed; top: 0; width: 100%; height: 40px;
      background: rgba(0,0,0,0.8); color: white; display: flex; align-items: center;
      padding: 0 10px; z-index: 1000;
    }
    #start-button {
      background: #222; border: none; color: white; padding: 6px;
      cursor: pointer; border-radius: 3px;
    }
    #taskbar-apps {
      display: flex; margin-left: 10px;
    }
    .task-btn {
      background: #333; border: none; color: white; padding: 6px 10px;
      margin-right: 5px; cursor: pointer; border-radius: 3px;
    }
    #update-notification {
      background: #0078d7; padding: 6px 10px; margin-left: 10px;
      border-radius: 3px; cursor: pointer;
    }
    #start-menu {
      position: fixed; top: 40px; left: 10px; width: 200px;
      background: rgba(50,50,50,0.95); color: white; display: none;
      flex-direction: column; border: 1px solid #444; border-radius: 5px; padding: 5px; z-index: 1001;
    }
    #start-menu button {
      background: none; border: none; color: white; padding: 8px;
      text-align: left; cursor: pointer; width: 100%;
    }
    .window {
      position: absolute; width: 600px; height: 400px;
      background: #f0f0f0; border: 1px solid #888; box-shadow: 2px 2px 10px rgba(0,0,0,0.5);
      display: none; z-index: 500; top: 90px; left: 50px;
    }
    .title-bar {
      background: #333; color: white; padding: 5px;
      cursor: move; display: flex; justify-content: space-between; align-items: center;
    }
    .title-bar.maximized {
      cursor: default;
    }
    .window.maximized {
      top: 40px !important; left: 0 !important; width: 100% !important; height: calc(100% - 40px) !important;
    }
    .win-btn {
      background: #444; border: none; color: white; width: 20px;
      height: 20px; line-height: 20px; text-align: center;
      border-radius: 50%; cursor: pointer; margin-left: 5px;
    }
    .min-btn { background: orange; }
    .max-btn { background: green; }
    .close-btn { background: red; }
    .content {
      padding: 10px; height: calc(100% - 30px); overflow: auto;
      background: white;
    }
    #calculator-content {
      display: flex; flex-direction: column; height: 100%;
    }
    #calculator-display {
      flex: 1; padding: 10px; border: 1px solid #ccc; margin-bottom: 10px;
      font-size: 18px; text-align: right; overflow-y: auto;
    }
    #calculator-buttons {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px;
    }
    #calculator-buttons button {
      padding: 10px; font-size: 16px; cursor: pointer;
      background: #ddd; border: 1px solid #ccc; border-radius: 5px;
    }
    #calculator-buttons button:hover {
      background: #bbb;
    }
    #explorer-list {
      list-style: none; padding: 0; margin: 0;
    }
    #explorer-list li {
      padding: 5px; border-bottom: 1px solid #ccc; cursor: pointer;
    }
    #explorer-actions {
      margin-bottom: 5px;
    }
    #explorer-actions button {
      margin-right: 5px;
    }
    #context-menu {
      position: absolute; width: 150px;
      background: rgba(50,50,50,0.95); color: white;
      border: 1px solid #444; border-radius: 5px; padding: 5px;
      display: none; flex-direction: column; z-index: 1002;
    }
    #context-menu button {
      background: none; border: none; color: white; padding: 8px;
      text-align: left; cursor: pointer; width: 100%;
    }
    #context-menu button:hover {
      background: rgba(255,255,255,0.1);
    }
    .desktop-icon {
      position: absolute; top: 90px; left: 20px; width: 80px; text-align: center;
      color: white; cursor: pointer; z-index: 400;
    }
    .desktop-icon div {
      width: 50px; height: 50px; margin: 0 auto;
      background: rgba(0,0,0,0.5); border-radius: 5px;
    }
    .desktop-icon span {
      display: block; margin-top: 5px; font-size: 12px; text-shadow: 1px 1px 2px #000;
    }
    #browser-url-bar {
      display: flex; margin-bottom: 5px;
    }
    #browser-url {
      flex-grow: 1; padding: 5px; border: 1px solid #ccc;
    }
    #browser-go {
      padding: 5px 10px; border: 1px solid #ccc; cursor: pointer;
    }
    #browser-frame {
      width: 100%; height: calc(100% - 30px); border: none;
    }
    #settings-content h3 {
      margin-top: 0;
    }
  </style>
</head>
<body>
  <!-- Boot Animation -->
  <div id="boot-screen">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Desktop Icons -->
  <div class="desktop-icon" ondblclick="showWindow('browser')">
    <div></div>
    <span>Browser</span>
  </div>
  <div class="desktop-icon" ondblclick="showWindow('calculator')">
    <div></div>
    <span>Powerful Calculator</span>
  </div>

  <!-- Taskbar and Start Menu -->
  <div id="taskbar">
    <button id="start-button">Start</button>
    <div id="taskbar-apps"></div>
    <span id="update-notification" style="display:none;">Update Available</span>
    <span style="margin-left: auto; padding-right: 10px;" id="version">Mini Web OS v1.0</span>
  </div>
  <div id="start-menu">
    <button id="open-notepad">Notepad</button>
    <button id="open-explorer">File Explorer</button>
    <button id="open-browser">Browser</button>
    <button id="open-calculator">Powerful Calculator</button>
    <button id="open-settings">Settings</button>
  </div>

  <!-- Notepad Window -->
  <div class="window" id="notepad" style="width: 300px; height: 200px;">
    <div class="title-bar" onmousedown="startDrag(event, 'notepad')">
      <span>Notepad</span>
      <div>
        <button class="win-btn min-btn" onclick="minimizeWindow('notepad')">−</button>
        <button class="win-btn max-btn" onclick="toggleMaximize('notepad')">□</button>
        <button class="win-btn close-btn" onclick="closeWindow('notepad')">×</button>
      </div>
    </div>
    <div class="content">
      <textarea style="width:100%; height:100%; resize:none;">Type here...</textarea>
    </div>
  </div>

  <!-- File Explorer Window -->
  <div class="window" id="explorer" style="width: 300px; height: 200px;">
    <div class="title-bar" onmousedown="startDrag(event, 'explorer')">
      <span>File Explorer</span>
      <div>
        <button class="win-btn min-btn" onclick="minimizeWindow('explorer')">−</button>
        <button class="win-btn max-btn" onclick="toggleMaximize('explorer')">□</button>
        <button class="win-btn close-btn" onclick="closeWindow('explorer')">×</button>
      </div>
    </div>
    <div class="content">
      <div id="explorer-actions">
        <button onclick="createItem('folder')">New Folder</button>
        <button onclick="createItem('file')">New Text File</button>
      </div>
      <ul id="explorer-list"></ul>
    </div>
  </div>

  <!-- Browser Window -->
  <div class="window" id="browser">
    <div class="title-bar" onmousedown="startDrag(event, 'browser')">
      <span>Web Browser</span>
      <div>
        <button class="win-btn min-btn" onclick="minimizeWindow('browser')">−</button>
        <button class="win-btn max-btn" onclick="toggleMaximize('browser')">□</button>
        <button class="win-btn close-btn" onclick="closeWindow('browser')">×</button>
      </div>
    </div>
    <div class="content">
      <div id="browser-url-bar">
        <input id="browser-url" type="text" placeholder="Enter URL or search query" />
        <button id="browser-go" onclick="navigateBrowser()">Go</button>
      </div>
      <iframe id="browser-frame" src="about:blank"></iframe>
    </div>
  </div>

  <!-- Calculator Window -->
  <div class="window" id="calculator" style="width: 300px; height: 400px;">
    <div class="title-bar" onmousedown="startDrag(event, 'calculator')">
      <span>Powerful Calculator</span>
      <div>
        <button class="win-btn min-btn" onclick="minimizeWindow('calculator')">−</button>
        <button class="win-btn max-btn" onclick="toggleMaximize('calculator')">□</button>
        <button class="win-btn close-btn" onclick="closeWindow('calculator')">×</button>
      </div>
    </div>
    <div class="content" id="calculator-content">
      <div id="calculator-display">0</div>
      <div id="calculator-buttons">
        <button onclick="calculatorInput('7')">7</button>
        <button onclick="calculatorInput('8')">8</button>
        <button onclick="calculatorInput('9')">9</button>
        <button onclick="calculatorInput('/')">/</button>
        <button onclick="calculatorInput('4')">4</button>
        <button onclick="calculatorInput('5')">5</button>
        <button onclick="calculatorInput('6')">6</button>
        <button onclick="calculatorInput('*')">×</button>
        <button onclick="calculatorInput('1')">1</button>
        <button onclick="calculatorInput('2')">2</button>
        <button onclick="calculatorInput('3')">3</button>
        <button onclick="calculatorInput('-')">-</button>
        <button onclick="calculatorInput('0')">0</button>
        <button onclick="calculatorInput('.')">.</button>
        <button onclick="calculatorCalculate()">=</button>
        <button onclick="calculatorInput('+')">+</button>
        <button onclick="calculatorClear()">C</button>
      </div>
    </div>
  </div>

  <!-- Settings Window -->
  <div class="window" id="settings" style="width: 400px; height: 300px;">
    <div class="title-bar" onmousedown="startDrag(event, 'settings')">
      <span>Settings</span>
      <div>
        <button class="win-btn min-btn" onclick="minimizeWindow('settings')">−</button>
        <button class="win-btn max-btn" onclick="toggleMaximize('settings')">□</button>
        <button class="win-btn close-btn" onclick="closeWindow('settings')">×</button>
      </div>
    </div>
    <div class="content" id="settings-content">
      <h3>Update</h3>
      <button onclick="checkForUpdates()">Check for Updates</button>
      <p id="update-status">No updates checked yet.</p>
    </div>
  </div>

  <!-- Context Menu for File Explorer -->
  <div id="context-menu">
    <button id="context-rename">Rename</button>
    <button id="context-delete">Delete</button>
    <button id="context-edit-content">Edit Content</button>
  </div>

  <script>
    // Boot Animation
    window.onload = () => {
      setTimeout(() => {
        document.getElementById('boot-screen').style.display = 'none';
        checkForUpdates();
      }, 3000);
    };

    let dragTarget = null, offsetX = 0, offsetY = 0;
    let fsData = JSON.parse(localStorage.getItem('fsData') || '{}');
    let contextTarget = null;
    const currentVersion = document.querySelector('meta[name="version"]').content;
    let latestHtml = null;
    let calculatorDisplay = '0';

    // Save window states
    function saveWindowStates() {
      const windows = ['notepad', 'explorer', 'browser', 'settings', 'calculator'];
      const states = {};
      windows.forEach(id => {
        const w = document.getElementById(id);
        if (w.style.display !== 'none') {
          states[id] = {
            top: w.style.top,
            left: w.style.left,
            width: w.style.width,
            height: w.style.height,
            maximized: w.classList.contains('maximized')
          };
        }
      });
      localStorage.setItem('windowStates', JSON.stringify(states));
    }

    // Restore window states
    function restoreWindowStates() {
      const states = JSON.parse(localStorage.getItem('windowStates') || '{}');
      for (const [id, state] of Object.entries(states)) {
        const w = document.getElementById(id);
        if (w) {
          w.style.top = state.top || '90px';
          w.style.left = state.left || '50px';
          w.style.width = state.width || '600px';
          w.style.height = state.height || '400px';
          if (state.maximized) {
            w.classList.add('maximized');
            w.querySelector('.title-bar').classList.add('maximized');
          }
          w.style.display = 'block';
        }
      }
    }

    function startDrag(e, id) {
      const windowEl = document.getElementById(id);
      if (windowEl.classList.contains('maximized')) return;
      dragTarget = windowEl;
      offsetX = e.clientX - dragTarget.offsetLeft;
      offsetY = e.clientY - dragTarget.offsetTop;
      document.addEventListener('mousemove', dragMove);
      document.addEventListener('mouseup', stopDrag);
    }
    function dragMove(e) {
      if (!dragTarget) return;
      dragTarget.style.left = `${e.clientX - offsetX}px`;
      dragTarget.style.top = `${e.clientY - offsetY}px`;
    }
    function stopDrag() {
      dragTarget = null;
      document.removeEventListener('mousemove', dragMove);
      document.removeEventListener('mouseup', stopDrag);
    }

    function showWindow(id) {
      const w = document.getElementById(id);
      w.style.display = 'block';
      removeTaskbarButton(id);
    }

    function closeWindow(id) {
      const w = document.getElementById(id);
      w.style.display = 'none';
      removeTaskbarButton(id);
    }

    function minimizeWindow(id) {
      const w = document.getElementById(id);
      w.style.display = 'none';
      addTaskbarButton(id, w.querySelector('.title-bar span').textContent);
    }

    function toggleMaximize(id) {
      const w = document.getElementById(id);
      if (w.classList.contains('maximized')) {
        w.style.top = w.dataset.origTop || '90px';
        w.style.left = w.dataset.origLeft || '50px';
        w.style.width = w.dataset.origWidth || '600px';
        w.style.height = w.dataset.origHeight || '400px';
        w.classList.remove('maximized');
        w.querySelector('.title-bar').classList.remove('maximized');
      } else {
        w.dataset.origTop = w.style.top;
        w.dataset.origLeft = w.style.left;
        w.dataset.origWidth = w.style.width;
        w.dataset.origHeight = w.style.height;
        w.classList.add('maximized');
        w.querySelector('.title-bar').classList.add('maximized');
      }
    }

    function addTaskbarButton(id, title) {
      const existing = document.querySelector(`.task-btn[data-id="${id}"]`);
      if (existing) return;
      const btn = document.createElement('button');
      btn.classList.add('task-btn');
      btn.dataset.id = id;
      btn.textContent = title;
      btn.onclick = () => {
        showWindow(id);
        removeTaskbarButton(id);
      };
      document.getElementById('taskbar-apps').appendChild(btn);
    }

    function removeTaskbarButton(id) {
      const btn = document.querySelector(`.task-btn[data-id="${id}"]`);
      if (btn) btn.remove();
    }

    document.getElementById('start-button').onclick = () => {
      const menu = document.getElementById('start-menu');
      menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
    };
    window.onclick = e => {
      if (!document.getElementById('start-menu').contains(e.target) &&
          e.target.id !== 'start-button') {
        document.getElementById('start-menu').style.display = 'none';
      }
      if (!document.getElementById('context-menu').contains(e.target)) {
        document.getElementById('context-menu').style.display = 'none';
      }
    };

    document.getElementById('open-notepad').onclick = () => showWindow('notepad');
    document.getElementById('open-explorer').onclick = () => showWindow('explorer');
    document.getElementById('open-browser').onclick = () => showWindow('browser');
    document.getElementById('open-calculator').onclick = () => showWindow('calculator');
    document.getElementById('open-settings').onclick = () => showWindow('settings');

    function createItem(type) {
      const name = prompt(`Enter ${type} name:`);
      if (!name) return;
      fsData[name] = { type, content: type === 'file' ? '' : null };
      localStorage.setItem('fsData', JSON.stringify(fsData));
      renderExplorer();
    }

    function renderExplorer() {
      const ul = document.getElementById('explorer-list');
      ul.innerHTML = '';
      for (const name in fsData) {
        const li = document.createElement('li');
        li.textContent = fsData[name].type === 'folder' ? `[Folder] ${name}` : `${name}.txt`;
        li.onclick = () => {
          if (fsData[name].type === 'file') {
            const text = prompt('Edit file content:', fsData[name].content);
            if (text !== null) {
              fsData[name].content = text;
              localStorage.setItem('fsData', JSON.stringify(fsData));
            }
          } else {
            alert('This is a folder!');
          }
        };
        li.oncontextmenu = e => {
          e.preventDefault();
          contextTarget = name;
          const menu = document.getElementById('context-menu');
          menu.style.left = `${e.clientX}px`;
          menu.style.top = `${e.clientY}px`;
          menu.style.display = 'flex';
          document.getElementById('context-edit-content').style.display = fsData[name].type === 'file' ? 'block' : 'none';
        };
        ul.appendChild(li);
      }
    }

    document.getElementById('context-rename').onclick = () => {
      if (!contextTarget) return;
      const newName = prompt('Enter new name:', contextTarget);
      if (newName && newName !== contextTarget && !fsData[newName]) {
        fsData[newName] = fsData[contextTarget];
        delete fsData[contextTarget];
        localStorage.setItem('fsData', JSON.stringify(fsData));
        renderExplorer();
      }
      document.getElementById('context-menu').style.display = 'none';
    };

    document.getElementById('context-delete').onclick = () => {
      if (!contextTarget) return;
      if (confirm(`Delete ${fsData[contextTarget].type} "${contextTarget}"?`)) {
        delete fsData[contextTarget];
        localStorage.setItem('fsData', JSON.stringify(fsData));
        renderExplorer();
      }
      document.getElementById('context-menu').style.display = 'none';
    };

    document.getElementById('context-edit-content').onclick = () => {
      if (!contextTarget || fsData[contextTarget].type !== 'file') return;
      const text = prompt('Edit file content:', fsData[contextTarget].content);
      if (text !== null) {
        fsData[contextTarget].content = text;
        localStorage.setItem('fsData', JSON.stringify(fsData));
      }
      document.getElementById('context-menu').style.display = 'none';
    };

    function navigateBrowser() {
      let input = document.getElementById('browser-url').value.trim();
      if (!input) return;

      let url;
      if (input.startsWith('http://') || input.startsWith('https://')) {
        url = input;
      } else if (input.includes('.') && !input.includes(' ')) {
        url = 'https://' + input;
      } else {
        url = 'https://www.google.com/search?q=' + encodeURIComponent(input);
      }

      document.getElementById('browser-frame').src = url;
      document.getElementById('browser-url').value = url;
    }

    document.getElementById('browser-url').addEventListener('keypress', e => {
      if (e.key === 'Enter') navigateBrowser();
    });

    function checkForUpdates() {
      const statusEl = document.getElementById('update-status');
      if (statusEl) statusEl.textContent = 'Checking for updates...';

      fetch('https://raw.githubusercontent.com/MAXNETAR/update.html.os/main/update.html')
        .then(response => {
          if (!response.ok) throw new Error('Update server not found or inaccessible');
          return response.text();
        })
        .then(html => {
          latestHtml = html;
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          const newVersionMeta = doc.querySelector('meta[name="version"]');
          const newVersion = newVersionMeta ? newVersionMeta.getAttribute('content') : 'v0.0';
          if (newVersion > currentVersion) {
            document.getElementById('update-notification').style.display = 'inline';
            if (statusEl) statusEl.textContent = `Update available: ${newVersion}`;
          } else {
            if (statusEl) statusEl.textContent = 'No updates available.';
          }
        })
        .catch(error => {
          console.error('Update check failed:', error);
          if (statusEl) statusEl.textContent = 'Failed to check updates: ' + error.message;
        });
    }

    document.getElementById('update-notification').onclick = () => {
      if (latestHtml) {
        if (confirm('Apply update? The page will reload.')) {
          saveWindowStates();
          localStorage.setItem('fsData', JSON.stringify(fsData));
          const blob = new Blob([latestHtml], { type: 'text/html' });
          const url = URL.createObjectURL(blob);
          window.location.href = url;
        }
      }
    };

    // Calculator Functions
    function calculatorInput(value) {
      if (calculatorDisplay === '0' && value !== '.') {
        calculatorDisplay = value;
      } else {
        calculatorDisplay += value;
      }
      document.getElementById('calculator-display').textContent = calculatorDisplay;
    }

    function calculatorClear() {
      calculatorDisplay = '0';
      document.getElementById('calculator-display').textContent = calculatorDisplay;
    }

    function calculatorCalculate() {
      try {
        const result = eval(calculatorDisplay.replace('×', '*'));
        calculatorDisplay = result.toString();
        document.getElementById('calculator-display').textContent = calculatorDisplay;
      } catch (e) {
        calculatorDisplay = 'Error';
        document.getElementById('calculator-display').textContent = calculatorDisplay;
        setTimeout(() => {
          calculatorDisplay = '0';
          document.getElementById('calculator-display').textContent = calculatorDisplay;
        }, 1000);
      }
    }

    // Restore state on load
    restoreWindowStates();
  </script>
</body>
</html>
